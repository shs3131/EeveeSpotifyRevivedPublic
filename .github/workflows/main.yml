name: Build EeveeSpotify IPA

on:
  workflow_dispatch:
    inputs:
      ipa_path:
        description: 'Path to the decrypted Spotify IPA'
        required: true
        default: 'Decrypted IPA/com.spotify.client-9.1.6-Decrypted.ipa'
      package_scheme:
        description: 'Package scheme (rootful or rootless)'
        required: false
        default: 'rootless'

jobs:
  build:
    runs-on: macos-latest
    env:
      VERSION: "6.4.8"
      OUTPUT_DIR: "Outputs/IPAS"

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Ensure build script is executable
        run: chmod +x ./build-ipa-local.sh

      - name: Set package scheme
        run: echo "THEOS_PACKAGE_SCHEME=${{ github.event.inputs.package_scheme }}" >> $GITHUB_ENV

      - name: Build EeveeSpotify IPA
        run: ./build-ipa-local.sh "${{ github.event.inputs.ipa_path }}"

      - name: Upload built IPAs
        uses: actions/upload-artifact@v4
        with:
          name: EeveeSpotify-IPAs
          path: ${{ env.OUTPUT_DIR }}
